<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.0/lottie.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 1s ease;
      background: linear-gradient(to right, #74ebd5, #acb6e5);
    }

    .app {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.2);
    }

    h1 {
      margin-bottom: 20px;
      color: #fff;
      text-shadow: 1px 1px 5px rgba(0,0,0,0.4);
    }

    .search-box {
      margin-bottom: 20px;
    }

    input {
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      width: 70%;
    }

    button {
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: #007BFF;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #0056b3;
    }

    .weather-card {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 15px;
      padding: 1rem;
      margin-top: 1rem;
      color: #fff;
    }

    #animationContainer {
      width: 120px;
      height: 120px;
      margin: 0 auto;
    }

    .toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 25px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 19px;
      width: 19px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: #007BFF;
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    #unitLabel {
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>üå§Ô∏è Weather App</h1>
    
    <div class="search-box">
      <input type="text" id="cityInput" placeholder="Enter city name...">
      <button id="searchBtn">Search</button>
    </div>

    <div class="toggle">
      <label class="switch">
        <input type="checkbox" id="unitToggle">
        <span class="slider round"></span>
      </label>
      <p id="unitLabel">Celsius</p>
    </div>

    <div class="weather-card">
      <div id="animationContainer"></div>
      <h2 id="cityName">--</h2>
      <p id="temp">--¬∞C</p>
      <p id="condition">--</p>
      <p id="humidity">Humidity: --%</p>
    </div>
  </div>

  <script>
    const cityInput = document.getElementById('cityInput');
    const searchBtn = document.getElementById('searchBtn');
    const unitToggle = document.getElementById('unitToggle');
    const unitLabel = document.getElementById('unitLabel');

    const cityName = document.getElementById('cityName');
    const temp = document.getElementById('temp');
    const condition = document.getElementById('condition');
    const humidity = document.getElementById('humidity');
    const animationContainer = document.getElementById('animationContainer');

    let isCelsius = true;
    let animation;

    async function getWeather(city) {
      try {
        const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}`);
        const geoData = await geoRes.json();

        if (!geoData.results || geoData.results.length === 0) {
          alert("City not found!");
          return;
        }

        const { latitude, longitude, name } = geoData.results[0];
        const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,weather_code`);
        const weatherData = await weatherRes.json();

        const current = weatherData.current;
        cityName.textContent = name;
        temp.textContent = `${current.temperature_2m.toFixed(1)}¬∞C`;
        humidity.textContent = \`Humidity: \${current.relative_humidity_2m}%\`;

        const code = current.weather_code;
        const weather = getWeatherDescription(code);
        condition.textContent = weather.text;

        updateBackground(weather.theme);
        playAnimation(weather.icon);

        localStorage.setItem("lastCity", city);
      } catch (error) {
        console.error(error);
      }
    }

    function getWeatherDescription(code) {
      const map = {
        0: { text: "Clear Sky", icon: "https://assets10.lottiefiles.com/packages/lf20_tmsiddoc.json", theme: "sunny" },
        1: { text: "Mainly Clear", icon: "https://assets2.lottiefiles.com/packages/lf20_q6mly1zq.json", theme: "cloudy" },
        2: { text: "Partly Cloudy", icon: "https://assets2.lottiefiles.com/packages/lf20_q6mly1zq.json", theme: "cloudy" },
        3: { text: "Overcast", icon: "https://assets9.lottiefiles.com/packages/lf20_3bt2y2.json", theme: "fog" },
        61: { text: "Light Rain", icon: "https://assets9.lottiefiles.com/private_files/lf30_qnpfavmd.json", theme: "rain" },
        71: { text: "Snow Fall", icon: "https://assets3.lottiefiles.com/packages/lf20_Stt1R2.json", theme: "snow" },
        95: { text: "Thunderstorm", icon: "https://assets6.lottiefiles.com/private_files/lf30_5ttqPi.json", theme: "thunder" }
      };
      return map[code] || { text: "Unknown", icon: "https://assets9.lottiefiles.com/packages/lf20_3bt2y2.json", theme: "fog" };
    }

    function updateBackground(theme) {
      const themes = {
        sunny: "linear-gradient(to right, #74ebd5, #acb6e5)",
        cloudy: "linear-gradient(to right, #bdc3c7, #2c3e50)",
        rain: "linear-gradient(to right, #667db6, #0082c8, #0082c8, #667db6)",
        thunder: "linear-gradient(to right, #232526, #414345)",
        snow: "linear-gradient(to right, #83a4d4, #b6fbff)",
        fog: "linear-gradient(to right, #757f9a, #d7dde8)"
      };
      document.body.style.background = themes[theme] || themes.sunny;
    }

    function playAnimation(file) {
      if (animation) animation.destroy();
      animation = lottie.loadAnimation({
        container: animationContainer,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: file
      });
    }

    searchBtn.addEventListener('click', () => {
      const city = cityInput.value.trim();
      if (city) getWeather(city);
    });

    unitToggle.addEventListener('change', () => {
      isCelsius = !isCelsius;
      unitLabel.textContent = isCelsius ? 'Celsius' : 'Fahrenheit';
      const currentTemp = temp.textContent.match(/[\d.]+/);
      if (currentTemp) {
        let value = parseFloat(currentTemp[0]);
        temp.textContent = isCelsius
          ? \`\${((value - 32) * 5 / 9).toFixed(1)}¬∞C\`
          : \`\${((value * 9 / 5) + 32).toFixed(1)}¬∞F\`;
      }
    });

    window.onload = () => {
      const lastCity = localStorage.getItem("lastCity");
      if (lastCity) getWeather(lastCity);
    };
  </script>
</body>
</html>
